!function(a){"use strict";var b,c={cache:{},init:function(){this.cacheElements(),this.bindEvents()},cacheElements:function(){this.cache={$window:a(window),$document:a(document)}},bindEvents:function(){var b=this;b.cache.$window.on("resize",a.proxy(b.tbPosition,b)),b.cache.$document.on("ready",function(){b.addItem(),b.removeItem(),b.tabbedNav(),b.addReadmore(),a(".envato-card").on("click","a.thickbox",function(){return tb_click.call(this),a("#TB_title").css({"background-color":"#23282d",color:"#cfcfcf"}),b.cache.$window.trigger("resize"),!1})})},addReadmore:function(){a(".envato-card .envato-card-top .column-description .description").each(function(){15<parseInt(a.trim(a(this).html()).split(/[\s\.\(\),]+/).length,10)&&a(this).addClass("closed").after('<a href="#" class="read-more closed">&hellip;</a>')}),a(".envato-card").on("click","a.read-more",function(b){b.preventDefault(),a(this).prev(".description").toggleClass("closed"),a(this).toggleClass("closed")})},addItem:function(){a(".add-envato-market-item").on("click",function(d){var e="envato-market-dialog-form";d.preventDefault(),0===a("#"+e).length&&a("body").append(wp.template(e)),b=a("#"+e).dialog({autoOpen:!0,modal:!0,width:350,buttons:{Save:{text:_envatoMarket.i18n.save,click:function(){var d,e,f,g=a(this);g.on("submit",function(a){a.preventDefault()}),e=g.find('input[name="token"]').val(),f=g.find('input[name="id"]').val(),d=wp.ajax.post(_envatoMarket.action+"_add_item",{nonce:_envatoMarket.nonce,token:e,id:f}),d.done(function(d){var e=wp.template("envato-market-item"),f=wp.template("envato-market-card"),g=wp.template("envato-market-auth-check-button");a(".nav-tab-wrapper").find('[data-id="'+d.type+'"]').removeClass("hidden"),d.item.type=d.type,a("#"+d.type+"s").append(f(d.item)).removeClass("hidden"),a("#envato-market-items").append(e({name:d.name,token:d.token,id:d.id,key:d.key,type:d.type,authorized:d.authorized})),0===a(".auth-check-button").length&&a("p.submit").append(g),b.dialog("close"),c.addReadmore()}),d.fail(function(a){var c=wp.template("envato-market-dialog-error"),d={message:a.message?a.message:_envatoMarket.i18n.error};b.find(".notice").remove(),b.find("form").prepend(c(d)),b.find(".notice").fadeIn("fast")})}},Cancel:{text:_envatoMarket.i18n.cancel,click:function(){b.dialog("close")}}},close:function(){b.find(".notice").remove(),b.find("form")[0].reset()}})})},removeItem:function(){a("#envato-market-items").on("click",".item-delete",function(c){var d=this,e="envato-market-dialog-remove";c.preventDefault(),0===a("#"+e).length&&a("body").append(wp.template(e)),b=a("#"+e).dialog({autoOpen:!0,modal:!0,width:350,buttons:{Save:{text:_envatoMarket.i18n.remove,click:function(){var c,e,f=a(this);f.on("submit",function(a){a.preventDefault()}),e=a(d).parents("li").data("id"),c=wp.ajax.post(_envatoMarket.action+"_remove_item",{nonce:_envatoMarket.nonce,id:e}),c.done(function(){var c=a('.col[data-id="'+e+'"]'),f=c.find(".envato-card").hasClass("theme")?"theme":"plugin";c.remove(),0===a("#"+f+"s").find(".col").length&&(a(".nav-tab-wrapper").find('[data-id="'+f+'"]').addClass("hidden"),a("#"+f+"s").addClass("hidden")),a(d).parents("li").remove(),a("#envato-market-items li").each(function(b){a(this).find("input").each(function(){a(this).attr("name",a(this).attr("name").replace(/\[\d\]/g,"["+b+"]"))})}),0!==a(".auth-check-button").length&&0===a("#envato-market-items li").length&&a("p.submit .auth-check-button").remove(),b.dialog("close")}),c.fail(function(a){var c=wp.template("envato-market-dialog-error"),d={message:a.message?a.message:_envatoMarket.i18n.error};b.find(".notice").remove(),b.find("form").prepend(c(d)),b.find(".notice").fadeIn("fast")})}},Cancel:{text:_envatoMarket.i18n.cancel,click:function(){b.dialog("close")}}}})})},tabbedNav:function(){var b=this,c=a(".about-wrap");a("div.panel",c).hide(),this.cache.$window.on("load",function(){var d=b.getParameterByName("tab"),e=window.location.hash.substr(1);d?a('.nav-tab-wrapper a[href="#'+d+'"]',c).click():e?a('.nav-tab-wrapper a[href="#'+e+'"]',c).click():a("div.panel:not(.hidden)",c).first().show()}),a(".nav-tab-wrapper a",c).on("click",function(){return a(".nav-tab-wrapper a",c).removeClass("nav-tab-active"),a("div.panel",c).hide(),a(this).addClass("nav-tab-active"),a("div"+a(this).attr("href"),c).show(),!1})},getParameterByName:function(a){var b,c;return a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search),null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},tbPosition:function(){var b=a("#TB_window"),c=a("#TB_iframeContent"),d=this.cache.$window.width(),e=this.cache.$window.height()-(d>792?90:50),f=d>792?772:d-20;return b.size()&&(b.width(f).height(e).css({"margin-left":"-"+parseInt(f/2,10)+"px"}),c.width(f).height(e),"undefined"!=typeof document.body.style.maxWidth&&b.css({top:(d>792?30:10)+"px","margin-top":"0"})),a("a.thickbox").each(function(){var b=a(this).attr("href");b&&(b=b.replace(/&width=[0-9]+/g,""),b=b.replace(/&height=[0-9]+/g,""),b=b+"&width="+f+"&height="+e,a(this).attr("href",b))})}};c.init()}(jQuery);