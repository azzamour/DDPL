window.wp=window.wp||{},function(a,b){"use strict";b.envato={},b.envato.ajaxNonce=window._wpUpdatesSettings.ajax_nonce,b.envato.l10n=window._wpUpdatesSettings.l10n,b.envato.shouldRequestFilesystemCredentials=null,b.envato.filesystemCredentials={ftp:{host:null,username:null,password:null,connectionType:null},ssh:{publicKey:null,privateKey:null}},b.envato.updateLock=!1,b.envato.updateDoneSuccessfully=!1,b.envato.updateQueue=[],b.envato.$elToReturnFocusToFromCredentialsModal=null,b.envato.decrementCount=function(b){var c,d,e=a("#wp-admin-bar-updates .ab-label"),f=a('a[href="update-core.php"] .update-plugins'),g=a("#menu-plugins");if(c=e.text(),c=parseInt(c,10)-1,!(0>c||isNaN(c))&&(a("#wp-admin-bar-updates .ab-item").removeAttr("title"),e.text(c),f.each(function(a,b){b.className=b.className.replace(/count-\d+/,"count-"+c)}),f.removeAttr("title"),f.find(".update-count").text(c),"plugin"===b)){if(d=g.find(".plugin-count").eq(0).text(),d=parseInt(d,10)-1,0>d||isNaN(d))return;g.find(".plugin-count").text(d),g.find(".update-plugins").each(function(a,b){b.className=b.className.replace(/count-\d+/,"count-"+d)}),d>0?a(".subsubsub .upgrade .count").text("("+d+")"):a(".subsubsub .upgrade").remove()}},b.envato.updatePlugin=function(c,d){var e,f=a(".envato-card-"+d).find(".update-now"),g=f.data("name");return f.attr("aria-label",b.envato.l10n.updatingLabel.replace("%s",g)),f.addClass("updating-message"),f.html()!==b.envato.l10n.updating&&f.data("originaltext",f.html()),f.text(b.envato.l10n.updating),b.a11y.speak(b.envato.l10n.updatingMsg),b.envato.updateLock?void b.envato.updateQueue.push({type:"update-plugin",data:{plugin:c,slug:d}}):(b.envato.updateLock=!0,e={_ajax_nonce:b.envato.ajaxNonce,plugin:c,slug:d,username:b.envato.filesystemCredentials.ftp.username,password:b.envato.filesystemCredentials.ftp.password,hostname:b.envato.filesystemCredentials.ftp.hostname,connection_type:b.envato.filesystemCredentials.ftp.connectionType,public_key:b.envato.filesystemCredentials.ssh.publicKey,private_key:b.envato.filesystemCredentials.ssh.privateKey},void b.ajax.post("update-plugin",e).done(b.envato.updateSuccess).fail(b.envato.updateError))},b.envato.updateTheme=function(c){var d,e=a(".envato-card-"+c).find(".update-now"),f=e.data("name");return e.attr("aria-label",b.envato.l10n.updatingLabel.replace("%s",f)),e.addClass("updating-message"),e.html()!==b.envato.l10n.updating&&e.data("originaltext",e.html()),e.text(b.envato.l10n.updating),b.a11y.speak(b.envato.l10n.updatingMsg),b.envato.updateLock?void b.envato.updateQueue.push({type:"upgrade-theme",data:{theme:c}}):(b.envato.updateLock=!0,d={_ajax_nonce:b.envato.ajaxNonce,theme:c,username:b.envato.filesystemCredentials.ftp.username,password:b.envato.filesystemCredentials.ftp.password,hostname:b.envato.filesystemCredentials.ftp.hostname,connection_type:b.envato.filesystemCredentials.ftp.connectionType,public_key:b.envato.filesystemCredentials.ssh.publicKey,private_key:b.envato.filesystemCredentials.ssh.privateKey},void b.ajax.post("upgrade-theme",d).done(b.envato.updateSuccess).fail(b.envato.updateError))},b.envato.updateSuccess=function(c){var d,e,f,g,h,i,j;d=a(".envato-card-"+c.slug),e=d.find(".column-update"),f=d.find(".update-now"),g=d.find(".version"),h=f.data("name"),i=f.data("version"),j=g.attr("aria-label").replace("%s",i),f.addClass("disabled"),f.attr("aria-label",b.envato.l10n.updatedLabel.replace("%s",h)),g.text(j),f.removeClass("updating-message").addClass("updated-message"),f.text(b.envato.l10n.updated),b.a11y.speak(b.envato.l10n.updatedMsg),e.addClass("update-complete").delay(1e3).fadeOut(),b.envato.decrementCount("plugin"),b.envato.updateDoneSuccessfully=!0,b.envato.updateLock=!1,a(document).trigger("envato-update-success",c),b.envato.queueChecker()},b.envato.updateError=function(c){var d,e;return b.envato.updateDoneSuccessfully=!1,c.errorCode&&"unable_to_connect_to_filesystem"===c.errorCode&&b.envato.shouldRequestFilesystemCredentials?void b.envato.credentialError(c,"update-plugin"):(d=a(".envato-card-"+c.slug).find(".update-now"),e=d.data("name"),d.attr("aria-label",b.envato.l10n.updateFailedLabel.replace("%s",e)),d.removeClass("updating-message"),d.html(b.envato.l10n.updateFailed.replace("%s",c.error)),b.a11y.speak(b.envato.l10n.updateFailed),b.envato.updateLock=!1,a(document).trigger("envato-update-error",c),void b.envato.queueChecker())},b.envato.showErrorInCredentialsForm=function(b){var c=a(".notification-dialog");c.find(".error").remove(),c.find("h3").after('<div class="error">'+b+"</div>")},b.envato.credentialError=function(a,c){b.envato.updateQueue.push({type:c,data:{plugin:a.plugin,slug:a.slug}}),b.envato.showErrorInCredentialsForm(a.error),b.envato.requestFilesystemCredentials()},b.envato.queueChecker=function(){var a;b.envato.updateLock||b.envato.updateQueue.length<=0||(a=b.envato.updateQueue.shift(),b.envato.updatePlugin(a.data.plugin,a.data.slug))},b.envato.requestFilesystemCredentials=function(c){!1===b.envato.updateDoneSuccessfully&&(b.envato.$elToReturnFocusToFromCredentialsModal=a(c.target),b.envato.updateLock=!0,b.envato.requestForCredentialsModalOpen())},b.envato.keydown=function(c){27===c.keyCode?b.envato.requestForCredentialsModalCancel():9===c.keyCode&&("upgrade"!==c.target.id||c.shiftKey?"hostname"===c.target.id&&c.shiftKey&&(a("#upgrade").focus(),c.preventDefault()):(a("#hostname").focus(),c.preventDefault()))},b.envato.requestForCredentialsModalOpen=function(){var c=a("#request-filesystem-credentials-dialog");a("body").addClass("modal-open"),c.show(),c.find("input:enabled:first").focus(),c.keydown(b.envato.keydown)},b.envato.requestForCredentialsModalClose=function(){a("#request-filesystem-credentials-dialog").hide(),a("body").removeClass("modal-open"),b.envato.$elToReturnFocusToFromCredentialsModal.focus()},b.envato.requestForCredentialsModalCancel=function(){var c,d;!1===b.envato.updateLock&&0===b.envato.updateQueue.length||(c=b.envato.updateQueue[0].data.slug,b.envato.updateLock=!1,b.envato.updateQueue=[],b.envato.requestForCredentialsModalClose(),d=a(".envato-card-"+c).find(".update-now"),d.removeClass("updating-message"),d.html(d.data("originaltext")),b.a11y.speak(b.envato.l10n.updateCancel))},b.envato.beforeunload=function(){return b.envato.updateLock?b.envato.l10n.beforeunload:void 0},a(document).ready(function(){b.envato.shouldRequestFilesystemCredentials=!(a("#request-filesystem-credentials-dialog").length<=0),a("#request-filesystem-credentials-dialog form").on("submit",function(){return b.envato.filesystemCredentials.ftp.hostname=a("#hostname").val(),b.envato.filesystemCredentials.ftp.username=a("#username").val(),b.envato.filesystemCredentials.ftp.password=a("#password").val(),b.envato.filesystemCredentials.ftp.connectionType=a('input[name="connection_type"]:checked').val(),b.envato.filesystemCredentials.ssh.publicKey=a("#public_key").val(),b.envato.filesystemCredentials.ssh.privateKey=a("#private_key").val(),b.envato.requestForCredentialsModalClose(),b.envato.updateLock=!1,b.envato.queueChecker(),!1}),a('#request-filesystem-credentials-dialog [data-js-action="close"], .notification-dialog-background').on("click",function(){b.envato.requestForCredentialsModalCancel()}),a('#request-filesystem-credentials-dialog input[name="connection_type"]').on("change",function(){a(this).parents("form").find("#private_key, #public_key").parents("label").toggle("ssh"===a(this).val())}).change(),a(".envato-card.plugin").on("click",".update-now",function(c){var d=a(c.target);c.preventDefault(),b.envato.shouldRequestFilesystemCredentials&&!b.envato.updateLock&&b.envato.requestFilesystemCredentials(c),b.envato.updatePlugin(d.data("plugin"),d.data("slug"))}),a(".envato-card.theme").on("click",".update-now",function(c){var d=a(c.target);c.preventDefault(),b.envato.shouldRequestFilesystemCredentials&&!b.envato.updateLock&&b.envato.requestFilesystemCredentials(c),b.envato.updateTheme(d.data("slug"))}),a("#plugin_update_from_iframe").on("click",function(b){var c,d;c=window.parent===window?null:window.parent,a.support.postMessage=!!window.postMessage,!1!==a.support.postMessage&&null!==c&&-1===window.parent.location.pathname.indexOf("update-core.php")&&(b.preventDefault(),d={action:"updatePlugin",slug:a(this).data("slug")},c.postMessage(JSON.stringify(d),window.location.origin))})}),a(window).on("message",function(c){var d,e=c.originalEvent,f=document.location,g=f.protocol+"//"+f.hostname;if(e.origin===g&&(d=a.parseJSON(e.data),"undefined"!=typeof d.action))switch(d.action){case"decrementUpdateCount":b.envato.decrementCount(d.upgradeType);break;case"updatePlugin":tb_remove(),a(".envato-card-"+d.slug).find("h4 a").focus(),a(".envato-card-"+d.slug).find('[data-slug="'+d.slug+'"]').trigger("click")}}),a(window).on("beforeunload",b.envato.beforeunload)}(jQuery,window.wp,window.ajaxurl);